---
sidebar_position: 4
---

# Лимиты

В процессе работы торговые роботы могут генерировать огромное количество заявок. 
Особенность алгоритмической торговли — большой процент отмен заявок, и пользователи 
могут генерировать большую нагрузку на инфраструктуру брокера. Поэтому у T-Invest API
есть система динамического формирования лимитов для пользователей.

Для всех запросов с одного адреса установлено суммарное ограничение. Мы рекомендуем разрабатывать роботов таким образом, 
чтобы общее число запросов по всем счетам и токенам в секунду не превышало 50.

:::caution
Значение лимита конкретного сервиса включает в себя суммарное количество допустимых запросов по всем методам этого сервиса.<br/><br/>
Лимитная политика распространяется на все аккаунты (cчета) пользователя.
:::

## Таблица лимитов unary-методов

| Сервисы                                                                                                | Способ интеграции | Лимит unary-запросов в минуту |
|:-------------------------------------------------------------------------------------------------------|:------------------|:------------------------------|
| [Сервис инструментов](/invest/services/instruments/head-instruments)                                   | gRPC<br/>REST     | 200                           |
| [Сервис счетов](/invest/services/accounts/head-account)                                                | gRPC<br/>REST     | 100                           |
| [Сервис операций](/invest/services/operations/head-operations)                                         | gRPC<br/>REST     | 200                           |
| Формирование отчетов в<br/>[сервисе операций](/invest/services/operations/head-operations)             | gRPC              | 5                             |
| [Сервис котировок](/invest/services/quotes/head-marketdata)                                            | gRPC<br/>REST     | 600                           |
| [Сервис стоп-ордеров](/invest/services/stop-orders/head-stoporders)                                    | gRPC<br/>REST     | 50                            |
| [Песочницы](/invest/intro/developer/sandbox/)                                                          | gRPC<br/>REST     | 200                           |
| [Сервис ордеров](/invest/services/orders/head-orders)                                                  | gRPC<br/>REST     | 100                           |
| [Сервис сигналов](/invest/services/signals/head-signals)                                               | gRPC<br/>REST     | 100                           |
| [Сервис автоследования](/invest/services/autofollow/head-autofollow)                                   | gRPC<br/>REST     | 100                           |
| Метод [getHistory](/invest/services/quotes/marketdata#get_history)                                     | REST              | 30                            |
| Метод [getOrders](/invest/services/orders/methods#getorders)                                           | gRPC<br/>REST     | 200                           |
| Метод [postOrder](/invest/services/orders/methods#postorder)                                           | gRPC<br/>REST     | 15 в секунду (900 в минуту)   |
| Метод [cancelOrder](/invest/services/orders/methods#cancelorder)                                       | gRPC<br/>REST     | 100                           |
| Метод [postOrderAsync](/invest/services/orders/methods#postorderasync)                                 | gRPC<br/>REST     | 600                           |
| Метод [getStopOrders](/invest/services/stop-orders/stoporders#getstoporders)                           | gRPC<br/>REST     | 60                            |

## Грейды

Есть 5 уровней доступа, которые зависят от количества выставленных заявок любого типа и
процента их исполнения.

| <nobr>Лимитный грейд</nobr>   | Активных stream-соединений<br/>[сервиса котировок](/invest/services/quotes/head-marketdata/) | Активных stream-соединений<br/>[сервиса ордеров](/invest/services/orders/head-orders/) | Активных stream-соединений на каждый метод<br/>[сервиса операций](/invest/services/operations/head-operations/) |
| :-------------   |:---------------------------------------------------------------------------------------------|:--------------------------------------------------------------------------|:----------------------------------------------------------------------------------------------------------------|
| 1                | 16                                                                                           | 10                                                                         | 11                                                                                                              |
| 2                | 16                                                                                           | 10                                                                         | 11                                                                                                              |
| 3                | 16                                                                                           | 10                                                                         | 11                                                                                                              |
| 4                | 16                                                                                           | 16                                                                         | 11                                                                                                              |
| 5                | 64                                                                                           | 16                                                                         | 11                                                                                                              |

:::caution
- В рамках одного stream-соединения [сервиса котировок](/invest/services/quotes/head-marketdata/) есть 
ограничение в 300 одновременных подписок на свечи, стаканы и ленту обезличенных сделок. Лимит считается
суммарно по всем трем типам данных. Лимитов на количество подписок в рамках одного стрима на торговые
статусы инструментов (подписка Info) нет. Максимальное количество запросов подписки в минуту — 100.
- В методе [Запросить тариф пользователя](/invest/services/accounts/users#getusertariff) лимиты для стрим-соединений могут возвращаться на 1 больше. Это сделано для того, чтобы вы могли переподключить стримы — поэтому мы не рекомендуем использовать максимальное количество из лимита.
- Если превысить лимит, вернется соответствующая ошибка. Превышения не будет, если количество запросов с IP-адреса клиента не превышает 1000 в минуту. Если вы подозреваете, что ваш IP-адрес забанили — обратитесь к нам в поддержку или в [Telegram-чат по общим вопросам](https://t.me/joinchat/VaW05CDzcSdsPULM).
- Воспользоваться максимальными лимитами по выставлению ордеров получится не всегда — это связано с задержками на стороне брокера. В первую очередь увеличение лимитов полезно для клиентов, которые торгуют с разных счетов. [Подробнее по производительность](/invest/intro/developer/speedup).
:::

Счетчик количества стрим-соединений обновляется каждые 2 минуты.

Лимитный грейд пользователя изменяется раз в сутки после окончания торгов. Для изменения
грейда берется статистика заявок, выполненных пользователем за последние 30 дней от текущей даты. 
Чем больше заявок выставляет пользователь при сохранении высокого уровня исполнения, тем выше его лимиты.

:::caution
Лимита на количество активных заявок нет.
:::

## Расчет грейдов

Лимитные грейды рассчитываются только для пользователей T-Invest API, которые выставляли заявки. Если вы не используете эту версию API для выставления заявок, у вас будет первый грейд. Чтобы грейд рассчитывался, нужно выставлять хотя бы одну заявку в месяц.

| Количество исполненных заявок / <br/> процент исполнения | Больше 50% | Больше 10% | Больше 2% | Меньше 2% |
|:---------------------------------------------------------|:-----------| :--------- | :--------- |:----------|
| Меньше **10**                                            | 1          | 1          | 1          | 1         | 
| Меньше **200**                                           | 2          | 2          | 2          | 1         | 
| Меньше **1 000**                                         | 4          | 3          | 2          | 1         | 
| Меньше **5 000**                                         | 5          | 4          | 3          | 1         | 
| Меньше **10 000**                                        | 5          | 5          | 4          | 2         | 
| Больше **10 000**                                        | 5          | 5          | 4          | 2         | 


## Ограничения по доставке данных в стримах

В пики активности на бирже возможны ситуации, когда за одну секунду происходят сотни событий по инструменту.

Для ограничения нагрузки на клиентов и на сервис были введены интервалы отправки сообщений в стрим.
За один интервал времени может быть отправлено только одно сообщение по одной подписке.

Таблица значений в миллисекундах:

| Тип подписки | Величина интервала |
|:---------------------|:-------------------|
| Trades               | Без ограничений    | 
| Orderbook            | 100                | 
| Candles              | 100                | 
| LastPrice            | Без ограничений    | 
| Info                 | Без ограничений    | 