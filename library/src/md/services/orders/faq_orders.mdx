---
sidebar_position: 5
---

# FAQ

### Для чего используется параметр `order_id` метода [PostOrder](/invest/services/orders/methods#postorder)? 

Сейчас у нас есть два параметра с одинаковым названием:

- <b>order_id</b> как входной параметр — ключ идемпотентности в формате `UID`. Уникальность значений 
отслеживается только за последний месяц.
- <b>order_id</b> как выходной параметр — биржевой идентификатор заявки, который в дальнейшем используется 
для отслеживания статуса заявки.

Если вы используете параметр как ключ идемпотентности, многократный вызов метода [PostOrder](/invest/services/orders/methods#postorder) с одинаковым **order_id** 
не приведет к выставлению более одного торгового поручения. 

При вызове метода проверяется уникальность связки **order_id** и **account_id**:

- Если указанная пара не найдена, создается новое торговое поручение.
- Если связка уже есть (поручение с этим **order_id** по данному номеру счета было выставлено раньше) — метод [PostOrder](/invest/services/orders/methods#postorder)
вернет статус уже выставленного торгового поручения, то есть отработает согласно логике метода [GetOrderState](/invest/services/orders/methods#getorderstate).

### Можно ли увидеть ключ идемпотентности ([`order_id`](/invest/services/orders/methods#postorderrequest)) в операциях, выставленных поручениях и т.п.?

Переданный **order_id** используется только как ключ идемпотентности, в ответах методов возвращается 
как **order_request_id**.

### Сколько хранится ключ идемпотентности (`order_id`) на стороне брокера?

Ключ хранится один месяц, но пока мы не может дать гарантию его сохранности. Сейчас подразумевается полная 
уникальность переданного **order_id** в разрезе номера счета — **account_id**.

### Что передавать в параметре `quantity` метода [PostOrder](/invest/services/orders/methods#postorder)? Количество бумаг или количество лотов? <a id="4.4"></a>

Требуемое количество лотов. 

У многих инструментов [лотность](/invest/intro/intro/glossary) не равна единице — учитывайте это при 
выставлении торговых поручений. 

### Как рассчитать полную стоимость сделки? 

Полная стоимость сделки включает в себя не только сумму операции покупки или продажи биржевого инструмента,
но и [комиссии брокера](https://www.tbank.ru/invest/help/brokerage/account/get-bs/tariff/), сервисные 
комиссии, гарантийное обеспечение для операций с фьючерсами и другие параметры.

Рассчитать размеры комиссий можно из описания [вашего тарифа](https://www.tbank.ru/invest/help/brokerage/account/get-bs/tariff/). Учитывайте, что комиссии берутся за сделки, а не за
поручение — то есть одно торговое поручение может рождать несколько сделок. Процент комиссии фиксированный 
в зависимости от тарифа. 

Размер начальной и фактической комиссии можно узнать в деталях торгового поручения через метод 
[GetOrderState](/invest/services/orders/methods#getorderstate).

[Подробнее про расчет стоимости сделок с фьючерсами и облигациями](/invest/services/quotes/faq_marketdata/)

### Можно ли получить список уже исполненных торговых поручений?

Да, но с ограничениями. Метод [GetOrders](/invest/services/orders/methods#getorders) возвращает не только список активных торговых
поручений. Исполненные, отмененные и отклоненные заявки можно получить, при этом 
необходимо учитывать особенности:

- возможно получить заявки только за сегодняшний день;
- не больше 100 заявок в ответе — используйте временные фильтры в запросе;
- максимальный интервал для выборки в одном запросе — 1 час.

### Какие есть статусы торговых поручений и что они означают?

- [Описание статусной модели торговых поручений](/invest/services/orders/head-orders)

- [Алгоритм и особенности исполнения торговых поручений](/invest/intro/intro/orders_details)

### Почему лимитная заявка исполнилась по другой цене?

Лимитное торговое поручение исполняется либо цене, указанной при ее выставлении, либо по «лучшей цене»
для определенного направления сделки. 
На бирже этот механизм называется Best Execution и подразумевает исполнение торгового поручения по цене, 
которая выгоднее указанной в поручении. 

### Как перевести цену поручения в тип `Quotation`?

[Подробнее о конвертации](/invest/intro/intro/faq_custom_types#quotation)

### Как изменить выставленную заявку?

Чтобы изменять уже выставленные поручения, используйте метод [replaceOrder](/invest/services/orders/methods#replaceorder).
Через него можно отменить существующую выставленную заявку и выставить новую с измененными параметрами.

### Можно ли выставлять поручения по счету Инвесткопилки? 

Нет. Если попытаться выставить поручение по счету Инвесткопилки через метод [PostOrder](/invest/services/orders/methods#postorder), в ответе вернется ошибка 
с кодом `40004` и сообщением `Working with orders is not available with this account`. 

### Нужно ли включать маржинальную торговлю для торгов на срочном рынке? 

Да. Для выставления поручений на срочном рынке нужно включить маржинальную торговлю в приложении и терминале —
иначе вернется ошибка `30051` из [cписка кодов ошибок](/invest/intro/developer/error-codes/errors/).

### Чем отличается рыночная заявка от лимитной?

| Рыночная заявка| Лимитная заявка| 
|----------|----------|
| Заявка на покупку или продажу активов по цене, которая есть на бирже в данный момент.   | Указание брокеру, какую бумагу или валюту, сколько лотов и по какой цене вы хотите купить или продать.  | 
| Если сейчас на бирже по текущей цене торгуется меньше лотов, чем вы указали, но при этом есть другие лоты по цене, которая отличается в негативную для вас сторону — брокер купит имеющееся количество лотов по текущей цене, а оставшуюся часть заявки будет покупать по следующей по списку цене. |Для сделок покупки лимитную заявку исполнят по цене равной или дешевле той, которую вы указали. Для сделок продажи лимитную заявку исполнят по цене равной или выше той, которую вы указали.  | 
| Используйте, только когда вам срочно нужно купить или продать актив по любой цене и вы готовы к тому, что она может оказаться для вас невыгодной.   | Используйте, чтобы не тратить время на постоянное отслеживание котировок на бирже и выполнить заявку по выгодной цене.  | 

Помимо рыночных и лимитных заявок, в T-Invest API можно выставлять заявки типа [«Лучшая цена»](https://www.tbank.ru/invest/help/brokerage/account/trade-on-bs/bids/?card=q6#:~:text=%D0%BD%D0%B5%D0%B2%D1%8B%D0%B3%D0%BE%D0%B4%D0%BD%D0%BE%D0%B9%20%D1%86%D0%B5%D0%BD%D0%B5%20%D0%BF%D0%BE%D0%BA%D1%83%D0%BF%D0%BA%D0%B8.-,%D1%87%D1%82%D0%BE%20%D1%82%D0%B0%D0%BA%D0%BE%D0%B5%20%D0%B7%D0%B0%D1%8F%D0%B2%D0%BA%D0%B0%20%C2%AB%D0%BB%D1%83%D1%87%D1%88%D0%B0%D1%8F%20%D1%86%D0%B5%D0%BD%D0%B0%C2%BB%3F,-%D0%AD%D1%82%D0%BE%20%D0%B7%D0%B0%D1%8F%D0%B2%D0%BA%D0%B0%20%D0%BD%D0%B0).

Рыночные заявки не доступны для опционов.

### Чем отличаются методы [GetOrders](/invest/services/orders/methods#getorders) и [GetOrderState](/invest/services/orders/methods#getorderstate)? 

| [GetOrders](/invest/services/orders/methods#getorders)| [GetOrderState](/invest/services/orders/methods#getorderstate)| 
|----------|----------|
| Предполагает получение массива активных заявок. | Предполагает получение статуса конкретной заявок по **order_id**. | 
| Возвращает только список активных торговых поручений, то есть поручений, которые еще не исполнены и не отменены. | Возвращает торговое поручение конкретного инструмента в любом статусе, в том числе после исполнения. | 
| Максимальный срок получения частично исполненной заявки через метод — до конца торгового дня, когда все неисполненные заявки отменяются и требуют повторного выставления.  |Метод не предусмотрен для получения глубокой истории и может не возвращать информацию по поручениям, которым больше одного дня.  | 

### Существуют ли ограничения на стоимость заявки? 

Да, на данный момент такие ограничения есть. Сейчас в T-Invest API нельзя выставить заявку со стоимостью выше установленных значений для каждой из валют — ее будет нужно подтверждать по СМС. Поэтому разбивайте такие заявки на заявки меньшего размера.

Если вы превысите лимит, вернется ошибка. [Все коды ошибок](/invest/intro/developer/error-codes/errors).

**Лимиты на стоимость заявки для разных валют**

| Валюта | Полное название валюты | Лимит |
|----------|----------|----------|
| RUB | Рубль  | 30 000 000   |
| USD   | Доллар США | 500 000  |
| EUR    | Евро  | 500 000  |
| GBP   | Фунт стерлингов  | 5 000 |
| CHF  | Швейцарский франк  | 5 000 |
| CNY   | Юань | 50 000 |
| JPY | Иена  | 500 000 |
| HKD  | Гонконгский доллар  | 50 000 |
| TRY   | Турецкая лира   | 50 000 |
| KZT  | Казахстанский тенге  | 500 000 |
| BYN  | Белорусский рубль | 50 000 |
| AMD   | Армянский драм  | 500 000 |
| UZS  | Узбекский сум  | 5 000 000 |
| KGS   | Киргизский сом  | 50 000 |
| TJS  | Таджикский сомони   | 50 000|
| XAU   | Золото  | 50 000 |
| XAG  | Серебро  | 50 000 |


### Для чего нужен параметр `confirm_margin_trade`?

С 1 апреля 2025 года по требованию Центрального Банка всем новым клиентам открываются брокерские счета с начальным уровнем риска 
(КНУР). По таким счетам все заявки, которые могут привести к непокрытой позиции (короткая позиция по деньгам или ценным бумагам, 
а также любая позиция в производных финансовых инструментах)
должны предварительно подтверждаться клиентом. Передавая значение `true` в параметре **confirm_margin_trade** при выставлении 
заявки, клиент подтверждает согласие на возможное формирование непокрытой позиции.

Параметр не является обязательным. Если на счете достаточно средств, заявка будет отправлена на исполнение при любом значении 
параметра.
Если в ходе предварительной проверки выяснится, что собственных средств не хватает и параметр **confirm_margin_trade** не 
передан или `false`, заявка будет отклонена с ошибкой.

Параметр актуален только для КНУР клиентов. Узнать свой уровень риска можно из значения **risk_level_code** ответа 
метода [getInfo](/invest/services/accounts/users#getinfo).



### Идентификатор торгового поручения

В сообщениях [стрима заявок](/invest/services/orders/methods#orderstatestream) есть параметр `trade_order_id` — идентификатор торгового поручения.
Его можно использовать для:

- идентификации активации стоп-заявки: у заявок, которые выставляются при активации стоп-заявки, этот параметр будет равен идентификатору стоп-заявки `stop_order_id`;
- связывания заявок на срочном рынке: после вечернего клиринга Биржа перевыставляет заявки, в результате чего меняется идентификатор заявки `order_id`, идентификатор торгового поручения при этом остается неизменным;