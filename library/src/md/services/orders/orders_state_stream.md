---
sidebar_position: 4
---

# Стрим заявок

**orders_state_stream** — cтрим-соединение T-Invest API для получения изменений состояния заявок.

Используется для получения событий по заявкам с момента выставления до момента исполнения или отмены. 
Переход заявки от одного статуса в другой формирует событие в стриме.

В статусе `PARTYALLY_FILL` события формируются по мере исполнения заявки.

## Особенности работы

В методе передаются все заявки по счету из подписки, но связать заявку в стриме с поручением, которое отправлено через
метод [PostOrder](/invest/services/orders/methods#postorder), можно не всегда.

Заявки, которые транслируются в стриме, можно идентифицировать по **order_request_id** — [ключу идемпотентности](/invest/services/orders/head-orders/#_6). Он передается при [выставлении заявки](/invest/services/orders/methods#postorder).

Чтобы поддержать клиентский идентификатор в стриме, передавайте [ключ идемпотентности](/invest/services/orders/faq_orders/#order_id-postorder_1) в формате UID.


### Ключ идемпотентности в формате UID

**order_request_id** в сообщениях стрима передается только формате UID. Если в [PostOrderRequest](/invest/services/orders/methods#postorderrequest) передать значение в другом формате, оно будет подменено в сообщениях стрима на сгенерированный API UID. Однозначно связать выставленное поручение не получится.

Возможные ответы стрима в зависимости от параметов, переданных в [PostOrderRequest](/invest/services/orders/methods#postorderrequest):

| Ключ идемпотентности             | Ответы стрима                                                                             |
|----------------------------------|-------------------------------------------------------------------------------------------|
| Не передан<br/> Передан не в UID | В сообщениях **order_request_id**, сгенерированный API                                      |
| Передан в UID                    | В сообщениях **order_request_id** из [PostOrder](/invest/services/orders/methods#postorder) |


## Сообщения стрима

### Статусы

1. Первое сообщение по поручению в стриме соответствует получению заявки брокером. На этом этапе еще не определен биржевой номер заявки, в **order_id** передается внутренний номер.
2. Статусная модель заявок в стриме отличается от модели заявок в unary методах. После того, как заявка перешла в статус `PARTYALLY_FILL` в стриме,
   она не может перейти в статус `CANCELED`, а остается в этом статусе в случае отмены.

    <img src="/img/invest/order_state_stream_status.png" width="650"/>


### Состав сообщений

Некоторые параметры ответа, например, список сделок и маркер, опциональные и ориентированы на будущее развитие метода.