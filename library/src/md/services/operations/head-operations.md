---
sidebar_position: 1
---

# Описание

Сервис для получения информации о портфеле по конкретному счету.

## Получить список операций по счету

В процессе работы торговому роботу нужно получать информацию об операциях по счету — например, чтобы
корректно рассчитывать доходности и собирать статистику своей работы. 

Для этого можно использовать два метода:

- [getOperations](/invest/services/operations/methods#getoperations).
- [getOperationsByCursor](/invest/services/operations/methods#getoperationsbycursor).

[getOperationsByCursor](/invest/services/operations/methods#getoperationsbycursor) — более предпочтительный для использования. Метод возвращает информацию обо всех операциях,
в том числе отмененных, поддерживает пагинацию, расширенную фильтрацию и обладает всеми преимуществами метода [getOperations](/invest/services/operations/methods#getoperations).

Для вызова методов во входных параметрах достаточно указать **account_ID**.

:::caution
Метод <a href="/invest/services/operations/methods#getoperations">getOperations</a>:<br />
<ul>
<li>Не поддерживает опционы. Для получения информации по операциям с опционами используйте метод <a href="/invest/services/operations/methods#getoperationsbycursor">getOperationsByCursor</a>.</li>
<li>Возвращает отмененные операции — параметр <b>state</b>. Учитывайте это в алгоритме работы. </li>
<li>Возвращает только последнюю тысячу операций.</li>
</ul>
:::

Мы не рекомендуем использовать метод получения операций для идентификации изменений
статусов торговых поручений — некоторые операции могут приходить с задержкой относительно реального
исполнения. 

Для получения статусов исполнения торговых поручений рекомендуем использовать [стрим](/invest/services/orders/head-orders#стрим-исполнения-поручений-пользователя) сервиса 
работы с торговыми поручениями. 

При работе учитывайте [особенности методов](/invest/services/operations/operations_problems).

## Получить портфолио

Чтобы торговый робот получал текущее состояние портфеля по счету, используйте метод [getPortfolio](/invest/services/operations/methods#getportfolio).

Отличие метода от [getPositions](/invest/services/operations/methods#getpositions) в том, что он
возвращает статистическую информацию по портфелю — абсолютные и относительные доходности, текущую 
стоимость активов и другое.

Обратите внимание: для расчета суммарной стоимости активов используются текущие цены биржевых
инструментов. Если в данный момент торги не ведутся, берется цена закрытия последней торговой 
сессии. 

:::caution
Сейчас запросить портфолио по счету Инвесткопилки нельзя — `type: ACCOUNT_TYPE_INVEST_BOX`.
:::

<p>Особенности: </p>
<ul>
<li><p>В методе есть булев параметр <b>blocked</b> — он принимает значение <code>true</code>, если инструмент
заблокирован депозитарием.</p>
</li>
<li><p>Значения средних цен покупки инструментов рассчитываются асинхронно. Возможна задержка в пересчете до одной секунды. Параметры:</p>
<ul>
<li><b>average_position_price_pt</b>;</li>
<li><b>average_position_price</b> — средневзвешенная цена позиции;</li>
<li><b>average_position_price_fifo</b> — средняя цена позиции по методу FIFO.</li>
</ul>
</li>
</ul>

[Подробнее о методах расчета с примерами](https://www.tbank.ru/help/invest-educate/yield-analysis/about/math-method/)

## Получить список позиций портфеля по счету

Для принятия решений торговому роботу нужно получать список актуальных позиций в портфеле — то есть 
количество ценных бумаг и валютных позиций по счету, включая заблокированные средства. 
Для этого мы рекомендуем использовать метод [getPositions](/invest/services/operations/methods#getpositions).

В методе также возвращаются:

- Тип инструмента для списка ценно-бумажных позиций портфеля — параметр **instrument_type**.
- Булев параметр **exchange_blocked** — принимает значение `true`, если инструмент заблокирован депозитарием.
- Массив опционов в портфеле.

:::caution
Метод не возвращает объем средств, заблокированных под гарантийное обеспечение фьючерсов. Для 
получения этой информации используйте метод [getWithdrawLimits](/invest/services/operations/methods#getwithdrawlimits).
:::

## Получить доступный остаток для вывода денежных средств

Используйте метод [getWithdrawLimits](/invest/services/operations/methods#getwithdrawlimits) — через него можно получить доступный баланс денежных средств для вывода и количество заблокированных валютных позиций. 

## Получить отчеты

В T-Invest API можно получать различные отчеты. Например, [брокерский отчет](/invest/services/operations/methods#getbrokerreport) или [справку о доходах за пределами РФ](/invest/services/operations/methods#getdivIDendsforeignissuer). 

:::info
Операции формирования отчетов трудоемкие, поэтому есть ограничения на период формирования отчета и лимиты на количество 
вызовов методов.
:::

Запрос справки о доходах за пределами РФ работает корректно, если верхний интервал запрашиваемых дат не позднее, чем 2
рабочих дня от текущей даты.

## Стрим позиций и доходности портфеля

gRPC server-side стрим [PortfolioStream](/invest/services/operations/methods#portfoliostream) предназначен для получения информации об изменении портфеля по факту
совершения сделок.

Стрим возвращает статистическую информацию по портфелю — абсолютные и относительные доходности, текущую стоимость активов 
и другие.

В валюте инструмента возвращаются:

- средневзвешенная цена позиции, 
- текущая рассчитанная доходность, 
- текущая цена инструмента,
- средняя цена лота в позиции по методу FIFO.

Для фьючерсов средняя цена лота в позиции возвращает количество в пунктах. 

## Стрим изменения позиций портфеля

gRPC server-side стрим [PositionsStream](/invest/services/operations/methods#positionsstream) предназначен для получения информации по изменению позиций портфеля.

В качестве входного необязательного параметра стрим принимает массив идентификаторов счетов, по которым вы хотите получать 
изменения позиций.

В качестве сообщений стрима приходят изменения позиций, объекты **money, securities, futures, options** и дата и время операции, 
изменившие позицию. 

### Торговые статусы инструментов и расписание торгов

[Торговые статусы инструментов и расписание торгов](/invest/intro/intro/faq_trading_status)

Также рекомендуем смотреть актуальную информацию по режимам и статусам торгов на сайтах [Московской биржи](https://www.moex.com/) и [СПБ биржи](https://spbexchange.ru/). 